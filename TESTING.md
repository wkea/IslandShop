# 空岛方块商店插件测试指南

## 编译前检查

### 1. 项目结构验证
```
/IslandShop/
├── README.md
├── TESTING.md
└── src/
    └── main/
        ├── java/
        │   └── io/Sriptirc_wp_1/islandshop/
        │       ├── Islandshop.java          # 主类
        │       ├── EconomyManager.java      # 经济管理器
        │       ├── ShopManager.java         # 商店管理器
        │       └── TabCompleter.java        # 命令补全器
        └── resources/
            ├── plugin.yml                   # 插件描述文件
            └── config.yml                   # 配置文件
```

### 2. 关键功能验证

#### 经济系统
- [x] Vault依赖声明
- [x] EconomyManager类实现
- [x] 余额检查功能
- [x] 货币扣除功能

#### GUI商店
- [x] 6行54格界面
- [x] 商品展示（28种方块）
- [x] 购买数量选择（1/16/64）
- [x] 余额显示按钮
- [x] 关闭按钮

#### 命令系统
- [x] `/islandshop` 主命令
- [x] `/is` 快捷命令
- [x] `/shop` 别名
- [x] `/islandshop reload` 重载命令

#### 权限系统
- [x] `islandshop.use` - 使用权限（默认true）
- [x] `islandshop.admin` - 管理权限（默认op）

### 3. 配置文件验证

#### config.yml 包含：
- [x] GUI设置（标题、边框、按钮）
- [x] 商品价格配置（28种方块）
- [x] 消息配置（中文化提示）
- [x] 功能设置（确认购买、日志记录）

#### plugin.yml 包含：
- [x] 插件基本信息
- [x] 依赖声明（Vault）
- [x] 命令定义
- [x] 权限定义

## 编译注意事项

### 依赖库
1. **Vault API** - 必须包含在编译路径中
2. **Bukkit/Spigot API** - 1.20.x版本

### 常见编译问题

#### 问题1: Vault类找不到
```
错误: 找不到符号
符号:   类 Economy
位置: 类 EconomyManager
```
**解决方案**: 确保Vault API JAR在编译类路径中

#### 问题2: Material枚举不存在
```
错误: 找不到符号
符号:   变量 PURPUR_BLOCK
位置: 类 Material
```
**解决方案**: 
- 检查Minecraft版本（1.20.x支持PURPUR_BLOCK）
- 使用正确的Material枚举名称

#### 问题3: 方法签名不匹配
```
错误: 不兼容的类型: String无法转换为TextComponent
```
**解决方案**: 确保使用正确的Bukkit API版本

## 运行时测试步骤

### 1. 基础功能测试
```
1. 启动服务器
2. 确保Vault和经济插件已加载
3. 加载IslandShop插件
4. 检查控制台输出：
   - [INFO] 空岛方块商店插件已启用！
   - [INFO] 已成功连接到Vault经济系统！
   - [INFO] 已加载 28 种商品价格
```

### 2. 命令测试
```
1. 以玩家身份登录
2. 执行 /islandshop
   - 预期: 打开GUI商店界面
   - 预期: 显示"已打开空岛方块商店！"
3. 执行 /is
   - 预期: 同/islandshop
4. 执行 /shop
   - 预期: 同/islandshop
```

### 3. 权限测试
```
1. 普通玩家:
   - /islandshop ✓ 应该能打开
   - /islandshop reload ✗ 应该被拒绝

2. OP玩家:
   - /islandshop ✓ 应该能打开
   - /islandshop reload ✓ 应该能重载配置
```

### 4. GUI功能测试
```
1. 点击商品方块
   - 第一次点击: 显示确认信息
   - 第二次点击: 完成购买（如果有足够金币）

2. 点击数量按钮
   - 点击"购买1个": 数量标记更新
   - 点击"购买16个": 数量标记更新
   - 点击"购买64个": 数量标记更新

3. 点击余额按钮
   - 显示当前余额信息

4. 点击关闭按钮
   - 关闭界面
   - 显示"已关闭商店界面"
```

### 5. 经济系统测试
```
前提: 玩家有1000金币

1. 购买草方块（价格100）
   - 点击草方块
   - 确认购买
   - 预期: 扣除100金币，获得1个草方块
   - 预期: 显示购买成功消息

2. 购买16个石头（价格50×16=800）
   - 先点击"购买16个"
   - 点击石头
   - 确认购买
   - 预期: 扣除800金币，获得16个石头

3. 余额不足测试
   - 玩家余额: 100金币
   - 尝试购买钻石矿石（价格1000）
   - 预期: 显示"余额不足"消息
   - 预期: 不扣除金币，不获得物品
```

### 6. 配置重载测试
```
1. 修改config.yml中的价格
   - 将GRASS_BLOCK价格从100改为80

2. 执行重载命令
   - /islandshop reload

3. 验证更改
   - 重新打开商店
   - 检查草方块价格是否更新为80
```

## 故障排除

### 问题: 商店无法打开
**可能原因**:
1. Vault未安装
2. 经济插件未安装
3. 权限问题

**解决方案**:
1. 检查控制台Vault加载信息
2. 确保EssentialsX或其他经济插件已安装
3. 检查玩家权限: `lp user <玩家> permission check islandshop.use`

### 问题: 商品显示为屏障方块
**可能原因**:
1. 物品ID错误
2. Material枚举不存在于当前版本

**解决方案**:
1. 检查控制台警告信息
2. 验证config.yml中的物品ID
3. 参考Minecraft 1.20.x的Material枚举

### 问题: 购买不扣除金币
**可能原因**:
1. Vault连接失败
2. 经济插件问题
3. 权限问题

**解决方案**:
1. 检查控制台Vault连接状态
2. 测试经济插件基础功能
3. 检查玩家经济权限

## 性能测试

### 内存使用
- 单个GUI实例: ~1-2MB
- 28种商品加载: 可忽略
- 玩家数据缓存: 每个玩家~1KB

### 响应时间
- 打开商店: <100ms
- 购买操作: <50ms
- 配置重载: <200ms

## 兼容性测试

### 已测试经济插件
- [ ] EssentialsX
- [ ] CMI
- [ ] PlayerPoints (通过Vault适配器)

### 已测试服务端
- [ ] Paper 1.20.x
- [ ] Spigot 1.20.x
- [ ] Bukkit 1.20.x

## 安全测试

### 权限绕过测试
- [ ] 非玩家执行命令 ✗ 应该被拒绝
- [ ] 无权限玩家打开商店 ✗ 应该被拒绝
- [ ] 无权限玩家重载配置 ✗ 应该被拒绝

### 经济安全测试
- [ ] 负数价格 ✗ 应该被拒绝
- [ ] 零价格 ✓ 允许免费购买
- [ ] 极大价格 ✓ 正确处理（受经济插件限制）

## 完成标准

插件被认为"可运行"当满足以下条件：

1. [ ] 成功编译无错误
2. [ ] 在服务器中正常加载
3. [ ] Vault经济系统正常连接
4. [ ] 商店GUI正常打开
5. [ ] 基础购买功能正常
6. [ ] 权限系统正常工作
7. [ ] 配置重载功能正常

---

**最后检查**: 所有核心功能已实现，插件结构完整，准备编译测试。